<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<th:block th:replace="~{/nav}"></th:block>
<head>
<meta charset="UTF-8">
<title>Insert title here</title>
<link rel="stylesheet"
	href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css">
<script
	src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.4/jquery.min.js"></script>
<script
	src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js"></script>
<style>
/* ìŠ¤í¬ë¡¤ ê°€ëŠ¥í•œ ì˜ì—­ì˜ ìŠ¤íƒ€ì¼ */
.table-container {
	max-height: 20em; /* ì›í•˜ëŠ” ë†’ì´ë¡œ ì¡°ì ˆ */
	overflow-y: auto; /* ì„¸ë¡œ ìŠ¤í¬ë¡¤ í‘œì‹œ */
}
</style>
</head>
<body>
	<div id="wrapper">
		<div id="commonCode">
			<div class="container">
				<h2>ê³µí†µ ì½”ë“œ</h2>
				<p>* ê³µí†µ ì½”ë“œ ê´€ë¦¬</p>
				<span>ì‚¬ìš© ì—¬ë¶€</span> <select>
					<option>Y</option>
					<option>N</option>
				</select> <span>ì½”ë“œ ê·¸ë£¹ëª… ë° ID</span> <input type="text" placeholder="ì…ë ¥">
				<input type="button" value="ê²€ìƒ‰">
				<div>
					<input id="commonCodeAddRowBtn" type="button" value="í–‰ì¶”ê°€">
					<input id="commonCodeDeleteRowBtn" type="button" value="í–‰ì‚­ì œ">
					<input id="saveBtn" type="button" value="ì €ì¥">
				</div>
				<div class="table-container">
					<table class="table table-striped commoncode-table">
						<thead>
							<tr>
								<th>ìƒíƒœ</th>
								<th>ì½”ë“œ ê·¸ë£¹ ID</th>
								<th>ì½”ë“œ ê·¸ë£¹ëª…</th>
								<th>ìƒì„¸ ì½”ë“œ ê°œìˆ˜</th>
								<th>ì‚¬ìš© ì—¬ë¶€</th>
							</tr>
						</thead>
						<tbody>
							<tr th:each="commonCode, i : ${commonCode}">
								<td th:text="${commonCode.flag}"></td>
								<td id="commonCode-group-id" th:text="${commonCode.codeGroupId}"></td>
								<td><input type="text"
									th:value="${commonCode.codeGroupName}"></td>
								<td th:text="${commonCode.codeDetailCount}"></td>
								<td><select>
										<option>Y</option>
										<option>N</option>
								</select></td>
							</tr>
						</tbody>
					</table>
				</div>
			</div>
			<div id="commonCodeDetail">
				<div></div>
				<div class="container">
					<h2>ìƒì„¸ ì½”ë“œ</h2>
					<p>
						ğŸ¨ ìƒì„¸ ì½”ë“œ ê´€ë¦¬ <sp
					an>ì‚¬ìš© ì—¬ë¶€</span> <select>
							<option>Y</option>
							<option>N</option>
						</select> <span>ì½”ë“œ ê·¸ë£¹ëª… ë° ID</span> <input type="text" placeholder="ì…ë ¥">
						<input type="button" value="ê²€ìƒ‰">
					<div class="table-container">
						<table class="table table-striped">
							<thead>
								<tr>
									<th>ìƒíƒœ</th>
									<th>ì„ íƒ</th>
									<th>ìƒì„¸ ì½”ë“œ</th>
									<th>ìƒì„¸ ì½”ë“œ ëª…</th>
									<th>ì‚¬ìš© ì—¬ë¶€</th>
								</tr>
							</thead>
							<tbody>
								<tr th:each="commonCodeDetail, i : ${commonCodeDetail}">
									<td th:text="${commonCodeDetail.flag}"></td>
									<td><input type="checkbox"></td>
									<td th:text="${commonCodeDetail.detailCode}"></td>
									<td th:text="${commonCodeDetail.detailCodeName}"></td>
									<td th:text="${commonCodeDetail.useYn}"></td>
								</tr>
							</tbody>
						</table>
					</div>
				</div>
			</div>
		</div>
	</div>

	<script th:inline="javascript">
		$(document)
				.ready(
						function() {
							var commonCode = `[[${commonCode}]]`;
							var commonCodeDetail = `[[${commonCodeDetail}]]`;

							var commonCodeList = JSON.parse(commonCode); // Object Type
							var commonCodeDetail = JSON.parse(commonCodeDetail);
							console.log(commonCodeList[0]);

							// ê³µí†µ ì½”ë“œ í–‰ì¶”ê°€ ë²„íŠ¼
							$("#commonCodeAddRowBtn")
									.click(
											function() {
												// ìƒˆë¡œìš´ í–‰ ìƒì„±
												var newRow = $("<tr>");
												var cell1 = $("<td>").text("C");
												var cell2 = $("<td>").append(
														"<input type='text'>");
												var cell3 = $("<td>").append(
														"<input type='text'>");
												var cell4 = $("<td>").text("-");
												var cell5 = $("<td>")
														.append(
																"<select><option>Y</option><option>N</option></select>");
												newRow.append(cell1);
												newRow.append(cell2);
												newRow.append(cell3);
												newRow.append(cell4);
												newRow.append(cell5);

												// í…Œì´ë¸”ì— ìƒˆë¡œìš´ í–‰ ì¶”ê°€
												$(".commoncode-table tbody")
														.append(newRow);

												// í–‰ ì¶”ê°€ ì‹œ ìŠ¤í¬ë¡¤ ë§¨ ì•„ë˜
												var tableContainer = $(".table-container");
												tableContainer
														.scrollTop(tableContainer[0].scrollHeight);
											});

							// ê³µí†µ ì½”ë“œ í–‰ì‚­ì œ ë²„íŠ¼
							$("#commonCodeDeleteRowBtn")
									.click(
											function() {
												var commonCodeTable = $(".commoncode-table tbody");
												var lastRow = commonCodeTable
														.find("tr:last");
												const codeGroupId = lastRow
														.find(
																"#commonCode-group-id")
														.text();
												console.log(codeGroupId);

												$
														.ajax({
															type : "GET",
															url : "/checkcodegroup?codeGroupId="
																	+ codeGroupId,
															success : function(
																	response) {
																console
																		.log(response);
																if (response > 0) {
																	alert("ì´ ì½”ë“œ ê·¸ë£¹ì€ DBì— ì¡´ì¬í•©ë‹ˆë‹¤. ì‚­ì œí•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");
																	return;
																} else {
																	// ì½”ë“œ ê·¸ë£¹ì´ DBì— ì¡´ì¬í•˜ì§€ ì•Šìœ¼ë©´ í•´ë‹¹ í–‰ì„ ì‚­ì œí•©ë‹ˆë‹¤.
																	lastRow
																			.remove();
																}
															},
															error : function(
																	xhr,
																	status,
																	error) {
																alert("ì—ëŸ¬ ë°œìƒ:",
																		error);
															}
														});
											});
						});
	</script>
</body>
</body>
</html>