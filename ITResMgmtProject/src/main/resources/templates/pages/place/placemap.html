<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
	xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
	layout:decorate="../common/layout/default">
<head>
<meta charset="UTF-8">
<style>
#map {
	height: 50vh;
	border: 1px solid #ccc;
	border-radius: 5px;
	box-shadow: 0px 0px 5px rgba(0, 0, 0, 0.2);
}

.place-table{
	font-size: 12px;
	border: 1px solid #ccc;
	border-radius: 5px;
	box-shadow: 0px 0px 5px rgba(0, 0, 0, 0.2);
}
.map-container{
	width: 50%;
}
.view-container{
	display:flex;
}

</style>
<link rel="stylesheet" href="https://uicdn.toast.com/chart/latest/toastui-chart.min.css" />
<script src="https://uicdn.toast.com/chart/latest/toastui-chart.min.js"></script>
</head>
<th:block layout:fragment="content">
	<main id="main" class="main">
			<div class="place-map-container">
				<div class="view-container">
					<div class="map-container">
						<input type="button" class="group-do" value="ğŸ’¢">
						<div id="map"></div>
					</div>
					<div class="chart-container">
						<div id="chart-area"></div>
					</div>
				</div>
				<div class="place-list-container">
					<select id="doNameSelect" class="form-select">
						<option value="-">ì„ íƒ</option>
						<option value="ALL">ì „ì²´ [ [[${totalResCount}]] ]</option>
						<option th:each="doName : ${doNames}" th:value="${doName.key}">[[${doName.key}]] [ [[${doName.value}]] ]</option>
					</select>
					<div class="place-table-container">
						<table class="table table-striped place-table">
							<thead class="fixed-header">
								<tr>
									<th>ë²ˆí˜¸</th>
									<th>ì„¤ì¹˜ ì¥ì†Œëª…</th>
									<th>ìš°í¸ë²ˆí˜¸</th>
									<th>ì£¼ì†Œ</th>
									<th>ìƒì„¸ ì£¼ì†Œ</th>
									<th>ì¥ë¹„ ê°œìˆ˜</th>
									<th>ìƒì„¸</th>
								</tr>
							</thead>
							<tbody class="place-table-body">
								<tr th:each="place, i : ${placePaging}">
									<td class="place-count" th:text="${i.count}"></td>
									<td class="place-name" th:text="${place.installPlaceName}"></td>
									<td class="place-postno" th:text="${place.installPlacePostno}"></td>
									<td class="place-address"
										th:text="${place.installPlaceAddress}"></td>
									<td th:if="${place.installPlaceDetailAddress != null}"
										class="place-detail-address"
										th:text="${place.installPlaceDetailAddress}"></td>
									<td th:if="${place.installPlaceDetailAddress == null}"
										class="place-detail-address">-</td>
									<td class="place-res-count" th:text="${place.resCount}"></td>
									<td><input name="search" type="button" value="ìƒì„¸"
										class="place-detail-btn"> <input name="placesn"
										class="place-sn" type="hidden"
										th:value="${place.installPlaceSn}"> <input
										type="hidden" class="latitude" th:value="${place.latitude}">
										<input type="hidden" class="longitude"
										th:value="${place.longitude}"></td>
								</tr>
							</tbody>
						</table>
						<input type="hidden" class="search-type" value="">
						<nav aria-label="Page navigation example" class="paging-nav">
							<ul class="pagination place-pagination justify-content-center">
								<li class="page-item">
									<button class="page-link prev-page-link" aria-label="Previous"
										value="0">
										<span aria-hidden="true">&laquo;</span> <span class="sr-only">Previous</span>
									</button>
								</li>
								<li class="page-item"
									th:each="pageNum : ${#numbers.sequence(paging.startPage, paging.endPage)}">
									<button class="page-link page-link-val" th:text="${pageNum}">1</button>
								</li>
								<li class="page-item">
									<button class="page-link next-page-link" aria-label="Next"
										value="6">
										<span aria-hidden="true">&raquo;</span> <span class="sr-only">Next</span>
									</button>
								</li>
							</ul>
						</nav>
					</div>
					<div class="resinfo-table-container">
						<table class="table table-striped place-table">
							<thead class="fixed-header">
								<tr>
									<th>ìì›ëª…</th>
									<th>IP</th>
									<th>IP ì¢…ë¥˜</th>
									<th>ìì› ìƒíƒœ</th>
									<th>ìì› ë¶„ë¥˜</th>
									<th>ë™ ì •ë³´</th>
									<th>ê´€ë¦¬ ë¶€ì„œ</th>
								</tr>
							</thead>
							<tbody class="resinfo-table-body">
								<tr>
									<th colspan="7" style="text-align:center;">ì¥ì†Œëª…ì„ í´ë¦­í•˜ì„¸ìš”.</th>
								</tr>
							</tbody>
						</table>
						<input type="hidden" class="res-search-type" value="">
						<nav aria-label="Page navigation example" class="paging-nav">
							<ul class="pagination res-pagination justify-content-center">
								<!-- <li class="page-item">
									<button class="page-link res-prev-page-link" aria-label="Previous" value="0"> 
										<span aria-hidden="true">&laquo;</span>
										<span class="sr-only">Previous</span>
									</button>
								</li>
								<li class="page-item"
									th:each="pageNum : ${#numbers.sequence(paging.startPage, paging.endPage)}">
									<button class="page-link res-page-link-val" th:text="${pageNum}">1</button>
								</li>
								<li class="page-item">
									<button class="page-link res-next-page-link" aria-label="Next" value="6"> 
										<span aria-hidden="true">&raquo;</span> 
										<span class="sr-only">Next</span>
									</button>
								</li> -->
							</ul>
						</nav>
					</div>
				</div>
			</div>
</main>
	<script th:src="@{/assets/js/main.js}"></script>
	<script type="text/javascript"
		src="//dapi.kakao.com/v2/maps/sdk.js?appkey=28bed2e7a81023c99f56920a94503f99&libraries=services,clusterer"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.4.0/Chart.min.js"></script>
	<script th:inline="javascript">
var places = `[[${placeList}]]`;
const doNames = `[[${doNames}]]`;
$(document).ready(function(){
	console.log(doNames);
	var mapContainer = document.getElementById('map'); // ì§€ë„ë¥¼ í‘œì‹œí•  div ìš”ì†Œ
    var mapOption = {
        center: new kakao.maps.LatLng(36.5, 127.5), // ì§€ë„ ì¤‘ì‹¬ ì¢Œí‘œ
        level: 12 // ì§€ë„ í™•ëŒ€ ë ˆë²¨
    };
    // ì§€ë„ë¥¼ ìƒì„±í•©ë‹ˆë‹¤.
    var map = new kakao.maps.Map(mapContainer, mapOption);
    var zoomControl = new kakao.maps.ZoomControl();
    map.addControl(zoomControl, kakao.maps.ControlPosition.RIGHT);
    
    var allMarkers = [];
	var regions = JSON.parse(places);
	var clusterers = groupDo(regions);
	
	clusterEvent(clusterers);
	markerClickEvent(allMarkers);
	
	function clusterEvent(clusterers){
		for (var groupName in clusterers) {
	        kakao.maps.event.addListener(clusterers[groupName], 'clusterclick', function(cluster) {
	        	var doName = cluster._model.texts;
	        	var markers = cluster._clusterer._markers;
	        	var placeName = {};
	        	placeName[groupName] = [];
	        	for(var i=0; i<markers.length; i++){
	        		placeName[groupName].push(markers[i].Gb);
	        	}
	        	var selectValue = doName[0].split(" ")[0];
	        	console.log(selectValue);
	        	
	        	var placeNameList = JSON.stringify(placeName[groupName]);

	        	$.ajax({
	                method: "GET",
	                url: "/place/map/city",
	                data: {
	                    doName: selectValue 
	                },
	                success: function(response){
	     		    	console.log(response);
	                	updateInstallPlaceList(response.place);
	                	installPlacePaging(response.paging);
	                	
	     		    	updateResInfo(response.resInfo);
	     		    	resInfoPaging(response.resInfoPaging);
	     		    	$(".res-search-type").val(doName);
	     		    	$("#doNameSelect").val(selectValue);
	                },
	                error: function(xhr, status, err){
	                	console.log(err);
	                }
	            });
	        });
	    }
	}
	
	function markerClickEvent(allMarkers){
		for(var i = 0; i < allMarkers.length; i++) {
	        for(var j = 0; j < allMarkers[i].length; j++) {
	            var marker = allMarkers[i][j];
	            kakao.maps.event.addListener(marker, 'click', (function (marker) {
	                return function () {
	                		var placeName = marker.Gb;
			                var position = marker.getPosition();
			                var lat = position.getLat();
			                var lng = position.getLng();
			                var url = 'https://map.kakao.com/link/map/' + placeName + ',' + lat + ',' + lng;
			                var findUrl = 'https://map.kakao.com/link/to/' + placeName + ',' + lat + ',' + lng;
			                
			                var iwContent = `<div style="padding:5px;">${placeName}<br><a href=${url} style="color:blue" target="_blank">í°ì§€ë„ë³´ê¸°</a> <a href=${findUrl} style="color:blue" target="_blank">ê¸¸ì°¾ê¸°</a></div>`;
		
			                var iwPosition = new kakao.maps.LatLng(33.450701, 126.570667);
		
			                // ì¸í¬ìœˆë„ìš°ë¥¼ ìƒì„±í•©ë‹ˆë‹¤
			                var infowindow = new kakao.maps.InfoWindow({
			                    position: iwPosition,
			                    content: iwContent,
			                    removable: true
			                });
			                // ë§ˆì»¤ ìœ„ì— ì¸í¬ìœˆë„ìš°ë¥¼ í‘œì‹œí•©ë‹ˆë‹¤.
			                infowindow.open(map, marker);
			                
			                $(".res-search-type").val(placeName);
			                var placeName = JSON.stringify(`${placeName}`);
			                $.ajax({
				        		   method: "POST", // POST ìš”ì²­ìœ¼ë¡œ ë³€ê²½
				        		   url: "/place/map/resinfo",
				        		   contentType: "application/json", // JSON ë°ì´í„° ì „ì†¡ì„ ëª…ì‹œ
				        		   data: placeName, 
				        		   success: function(response) {
				        		       console.log(response);
				        		       updateInstallPlace(response.place);
				        		       installPlacePaging(response.paging);
				        		       
				        		       updateResInfo(response.resInfo);
				        		       resInfoPaging(response.resInfoPaging);
				        		       
				        		       $("#doNameSelect").val("-");
				        		   },
				        		   error: function(xhr, status, err) {
				        		       alert(err);
				        		   }
				        	});
	                };
	            })(marker));
	        }
	    }
	} 
	
	function updateInstallPlaceList(place) {
	    $(".place-table-body tr").remove();
	    if(place.length < 1 || place[0] === null){
        	const result = "<tr>" + "<td colspan='7' style='text-align:center; font-weight: bold;'>" + "í•´ë‹¹ ì§€ì—­ì— ì„¤ì¹˜ ì¥ì†Œê°€ ì—†ìŠµë‹ˆë‹¤." + "</td>" + "</tr>";
        	$(".place-table-body").append(result);
        	return;
        }
	    // í…Œì´ë¸”ì˜ tbody ìš”ì†Œ ì„ íƒ
	    var placeBody = $(".place-table-body");
	    
	    // ê° place ê°ì²´ì— ëŒ€í•´ ìƒˆë¡œìš´ í–‰ì„ ìƒì„±í•˜ê³  ì¶”ê°€
	    for (var i = 0; i < place.length; i++) {
	    	 // ë°ì´í„°ê°€ nullì¸ ê²½ìš° ëŒ€ì²´ ë¬¸ìì—´ ì§€ì •
		    var installPlaceName = place[i].installPlaceName || "-";
		    var installPlacePostno = place[i].installPlacePostno || "-";
		    var installPlaceAddress = place[i].installPlaceAddress || "-";
		    var installPlaceDetailAddress = place[i].installPlaceDetailAddress || "-";
		    var resCount = place[i].resCount || "0";
		    var installPlaceSn = place[i].installPlaceSn || "-";
		    var latitude = place[i].latitude || "0";
		    var longitude = place[i].longitude || "0";
		    
	        var newRow = '<tr>' +
	            '<td class="place-count">' + (place[i].rn) + '</td>' +
	            '<td class="place-name">' + installPlaceName + '</td>' +
	            '<td class="place-postno">' + installPlacePostno + '</td>' +
	            '<td class="place-address">' + installPlaceAddress + '</td>' +
	            '<td class="place-detail-address">' + installPlaceDetailAddress + '</td>' +
	            '<td class="place-res-count">' + resCount + '</td>' +
	            '<td>' +
	            '<input name="search" type="button" value="ìƒì„¸" class="place-detail-btn">' +
	            '<input name="placesn" class="place-sn" type="hidden" value="' + installPlaceSn + '">' +
	            '<input type="hidden" class="latitude" value="' + latitude + '">' +
	            '<input type="hidden" class="longitude" value="' + longitude + '">' +
	            '</td>' +
	            '</tr>';
	        
	        placeBody.append(newRow);
	    }
	}
	
	function updateInstallPlace(place) {
	    // í…Œì´ë¸”ì˜ tbody ìš”ì†Œ ì„ íƒ
	    var placeBody = $(".place-table-body");

	    // ê¸°ì¡´ í–‰ì„ ëª¨ë‘ ì œê±°
	    placeBody.empty();
	    var installPlaceName = place.installPlaceName || "-";
	    var installPlacePostno = place.installPlacePostno || "-";
	    var installPlaceAddress = place.installPlaceAddress || "-";
	    var installPlaceDetailAddress = place.installPlaceDetailAddress || "-";
	    var resCount = place.resCount || "0";
	    var installPlaceSn = place.installPlaceSn || "-";
	    var latitude = place.latitude || "-";
	    var longitude = place.longitude || "-";

	    // ìƒˆë¡œìš´ í–‰ì„ ìƒì„±
	    var newRow = '<tr>' +
	        '<td class="place-count">' + 1 + '</td>' +
	        '<td class="place-name">' + installPlaceName + '</td>' +
	        '<td class="place-postno">' + installPlacePostno + '</td>' +
	        '<td class="place-address">' + installPlaceAddress + '</td>' +
	        '<td class="place-detail-address">' + installPlaceDetailAddress + '</td>' +
	        '<td class="place-res-count">' + resCount + '</td>' +
	        '<td>' +
	        '<input name="search" type="button" value="ìƒì„¸" class="place-detail-btn">' +
	        '<input name="placesn" class="place-sn" type="hidden" value="' + installPlaceSn + '">' +
	        '<input type="hidden" class="latitude" value="' + latitude + '">' +
	        '<input type="hidden" class="longitude" value="' + longitude + '">' +
	        '</td>' +
	        '</tr>';

	    // ìƒˆë¡œìš´ í–‰ì„ ì¶”ê°€
	    placeBody.append(newRow);
	}
	
	// ìì› ì •ë³´ ì—…ë°ì´íŠ¸
	function updateResInfo(resInfo){
		$(".resinfo-table-body tr").remove();
		
		if(resInfo.length < 1 || resInfo[0] === null){
        	const result = "<tr>" + "<td colspan='7' style='text-align:center; font-weight: bold;'>" + "ë§¤í•‘ëœ ìì›ì´ ì—†ìŠµë‹ˆë‹¤." + "</td>" + "</tr>";
        	$(".resinfo-table-body").append(result);
        	return;
        }
        
        for(var i = 0; i < resInfo.length; i++){
        	var newRow = $("<tr>");
        	var ip;
        	var ipTypeCodeName;
        	const resName = $("<td>").text(resInfo[i].resName).attr({
                class: "res-name",
                "data-install-place-sn": resInfo[i].installPlaceSn
            });
        	if(resInfo[i].ip === null){
        		ip = $("<td>").text("-").attr({
        			class: "ip",
        			"data-ip-sn": ""
        		})
        	}else{
	            ip = $("<td>").text(resInfo[i].ip).attr({
	                class: "ip",
	                "data-ip-sn": resInfo[i].ipSn
	            });
	        }
        	if(resInfo[i].ipTypeCodeName === null){
            	ipTypeCodeName = $("<td>").text("-").addClass("ip-type-code-name");
        	}else{
            	ipTypeCodeName = $("<td>").text(resInfo[i].ipTypeCodeName).addClass("ip-type-code-name");
        	}
            const resStatusCodeName = $("<td>").text(resInfo[i].resStatusCodeName).addClass("res-status-code-name");
            const resClassName = $("<td>").text(resInfo[i].resClassName).addClass("res-class-name");
            const rackInfo = $("<td>").text(resInfo[i].rackInfo).addClass("rack-info");
            const mgmtDeptName = $("<td>").text(resInfo[i].mgmtDeptName).addClass("mgmt-dept-name");

            newRow.append(resName);
            newRow.append(ip);
            newRow.append(ipTypeCodeName);
            newRow.append(resStatusCodeName);
            newRow.append(resClassName);
            newRow.append(rackInfo);
            newRow.append(mgmtDeptName);
        	$(".resinfo-table-body").append(newRow);
        }
	}
	$(".group-do").click(() => {
		setMapLevel();
	})
	
	function setMapLevel(){
		var moveLatLon = new kakao.maps.LatLng(36.5, 127.5);
		map.setCenter(moveLatLon);
		map.setLevel(12);
	}
	
	function groupDo(regions){
        var groupedRegions = {};
        // ì§€ì—­ ì •ë³´ë¥¼ ê·¸ë£¹í™”í•©ë‹ˆë‹¤.
        regions.forEach(function (region) {
            if (!groupedRegions[region.doName]) {
                groupedRegions[region.doName] = [];
            }
            groupedRegions[region.doName].push(region);
        });
        
        var clusterers = {};
        var infowindows = [];
        for (var groupName in groupedRegions) {
        	// ë„ ë³„ë¡œ ê·¸ë£¹í•‘
            var group = groupedRegions[groupName];
            var resCount = 0;
			var clusterSize = 1;
			for (var i = 0; i < group.length; i++) {
	            resCount += group[i].resCount;
	        }
			
			clusterers[groupName] = new kakao.maps.MarkerClusterer({
                map: map,
                averageCenter: true,
                clickable: true,
                minLevel: 5,
                minClusterSize: clusterSize,
                texts: [groupName],
                calculator: [1, 2, 3]
            });

            var markers = [];
            var positions = [];
            for (var i = 0; i < group.length; i++) {
                var marker = new kakao.maps.Marker({
                    position: new kakao.maps.LatLng(group[i].latitude, group[i].longitude),
                    title: group[i].installPlaceName,
                    clickable: true
                });
                markers.push(marker);
                
                var content = '<div>' + group[i].installPlaceName + '</div>';
                var infowindow = new kakao.maps.InfoWindow({
			        content: content // ì¸í¬ìœˆë„ìš°ì— í‘œì‹œí•  ë‚´ìš©
    			});
                infowindows.push(infowindow);
                kakao.maps.event.addListener(marker, 'mouseover', makeOverListener(map, marker, infowindow));
                kakao.maps.event.addListener(marker, 'mouseout', makeOutListener(infowindow));
            }
            allMarkers.push(markers);
            clusterers[groupName].addMarkers(markers);
        }
        return clusterers;
	}
	
	// ì¸í¬ìœˆë„ìš°ë¥¼ í‘œì‹œí•˜ëŠ” í´ë¡œì €ë¥¼ ë§Œë“œëŠ” í•¨ìˆ˜ì…ë‹ˆë‹¤ 
	function makeOverListener(map, marker, infowindow) {
	    return function() {
	        infowindow.open(map, marker);
	    };
	}

	// ì¸í¬ìœˆë„ìš°ë¥¼ ë‹«ëŠ” í´ë¡œì €ë¥¼ ë§Œë“œëŠ” í•¨ìˆ˜ì…ë‹ˆë‹¤ 
	function makeOutListener(infowindow) {
	    return function() {
	        infowindow.close();
	    };
	}
	
	function pagingClick(startPage){
		var searchType =  $("#doNameSelect").val();
		if(searchType === "-"){
			return;
		}
		if(searchType === "" || searchType === "undefined"){
			searchType = "ALL"
		}
		$.ajax({
			method: "GET",
			url: "/place/map/paging/" + startPage,
			data: {
				searchType: searchType
			},
			success: function(response){
				console.log(response);
				updateInstallPlaceList(response.place);
				installPlacePaging(response.paging);
			},
			error: function(xhr, status, err){
				console.log(err);
			}
		});
	}
	
	function resPagingClick(startPage){
		var resSearchType = $(".res-search-type").val();
		console.log(resSearchType);
		
		$.ajax({
			method: "GET",
			url: "/place/map/resinfo/paging/" + startPage,
			data: {
				resSearchType: resSearchType
			},
			success: function(response){
				console.log(response);
				updateResInfo(response.resInfo);
				resInfoPaging(response.resInfoPaging);
			},
			error: function(xhr, status, err){
				console.log(err);
			}
		})
	}
	// í˜ì´ì§€ í´ë¦­
	$(".pagination").on("click", ".page-link-val", function(){
		var page = $(this).text();
		pagingClick(page);
	});
	// ì´ì „ í˜ì´ì§€ í´ë¦­
	$(".pagination").on("click", ".prev-page-link", function(){
		var prevStartPage = $(this).val() - 4;
		pagingClick(prevStartPage);
	})
	// ë‹¤ìŒ í˜ì´ì§€ í´ë¦­
	$(".pagination").on("click", ".next-page-link", function () {
		var nextStartPage = $(this).val();
		pagingClick(nextStartPage);
	}); 
	
	// ìì› í˜ì´ì§€ í´ë¦­
	$(".res-pagination").on("click", ".res-page-link-val", function(){
		var page = $(this).text();
		resPagingClick(page);	
	})
	
	$(".res-pagination").on("click", ".res-prev-page-link", function(){
		var page = $(this).val() - 4;
		console.log("A");
		resPagingClick(page);	
	})
	
	$(".res-pagination").on("click", ".res-next-page-link", function(){
		var page = $(this).val();
		resPagingClick(page);
	})
	
	function installPlacePaging(paging) {
	    var pagination = $(".place-pagination");
	    
	    pagination.empty();
		if(paging.endPage === 0){
			return;
		}
	    
	    pagination.append(`<li class='page-item'><button class='page-link prev-page-link' value="${paging.startPage - 1}" aria-label='Previous'>&laquo;</button></li>`);
	    
	    for (var pageNum = paging.startPage; pageNum <= paging.endPage; pageNum++) {
	        pagination.append("<li class='page-item'><button class='page-link page-link-val'>" + pageNum + "</button></li>");
	    }
	    
	    pagination.append(`<li class='page-item'><button class='page-link next-page-link' value="${paging.endPage + 1}" aria-label='Next'>&raquo;</button></li>`);

	    // ì´ì „ í˜ì´ì§€ê°€ ì—†ëŠ” ê²½ìš° ì´ì „ ë²„íŠ¼ ë¹„í™œì„±í™”
	    if (paging.startPage === 1 || $(".prev-page-link").val() === 0) {
	        pagination.find(".prev-page-link").prop("disabled", true);
	        console.log(paging.startPage);
	    }
	    
	    // ë‹¤ìŒ í˜ì´ì§€ê°€ ì—†ëŠ” ê²½ìš° ë‹¤ìŒ ë²„íŠ¼ ë¹„í™œì„±í™”
	    if (paging.endPage === paging.totalPageCount) {
	        pagination.find(".next-page-link").prop("disabled", true);
	    }
	}
	
	// ìì› í˜ì´ì§• ì²˜ë¦¬
	function resInfoPaging(paging){
		var pagination = $(".res-pagination");
		
	    pagination.empty();
	    if(paging.endPage === 0){
			return;
		}
	    
	    pagination.append(`<li class='page-item'><button class='page-link res-prev-page-link' value="${paging.startPage - 1}" aria-label='Previous'>&laquo;</button></li>`);
	    
	    for (var pageNum = paging.startPage; pageNum <= paging.endPage; pageNum++) {
	        pagination.append("<li class='page-item'><button class='page-link res-page-link-val'>" + pageNum + "</button></li>");
	    }
	    
	    pagination.append(`<li class='page-item'><button class='page-link res-next-page-link' value="${paging.endPage + 1}" aria-label='Next'>&raquo;</button></li>`);

	    // ì´ì „ í˜ì´ì§€ê°€ ì—†ëŠ” ê²½ìš° ì´ì „ ë²„íŠ¼ ë¹„í™œì„±í™”
	    if (paging.startPage === 1 || $(".res-prev-page-link").val() === 0) {
	        pagination.find(".res-prev-page-link").prop("disabled", true);
	    }
	    
	    // ë‹¤ìŒ í˜ì´ì§€ê°€ ì—†ëŠ” ê²½ìš° ë‹¤ìŒ ë²„íŠ¼ ë¹„í™œì„±í™”
	    if (paging.endPage === paging.totalPageCount) {
	        pagination.find(".res-next-page-link").prop("disabled", true);
	    }
	}
	
	
    $(".place-list-container").on("click", ".place-detail-btn", function(){
    	var clickedRow = $(this).closest("tr");
        var placeName = clickedRow.find(".place-name").text();
        var placeAddress = clickedRow.find(".place-address").text();
		var latitude = clickedRow.find(".latitude").val();
		var longitude = clickedRow.find(".longitude").val();
		
        $(".res-search-type").val(placeName);
		
		$.ajax({
	  		method: "POST", // POST ìš”ì²­ìœ¼ë¡œ ë³€ê²½
	  		url: "/place/map/resinfo",
	  		contentType: "application/json", // JSON ë°ì´í„° ì „ì†¡ì„ ëª…ì‹œ
	  		data: placeName, 
	  		success: function(response) {
	  		    console.log(response);
	  		    updateInstallPlace(response.place);
	  		    installPlacePaging(response.paging);
	  		    
	  		    updateResInfo(response.resInfo);
	  		    resInfoPaging(response.resInfoPaging);
	  		    
	  		    console.log(response.place.installPlaceAddress);
	  		    $("#doNameSelect").val("-");
	  		},
	  		error: function(xhr, status, err) {
	  		    alert(err);
	  		}
  		});
        panTo(latitude, longitude);
    });
    
    function panTo(latitude, longitude) {
        // ì´ë™í•  ìœ„ë„ ê²½ë„ ìœ„ì¹˜ë¥¼ ìƒì„±í•©ë‹ˆë‹¤ 
        var moveLatLon = new kakao.maps.LatLng(latitude, longitude);
        // ì§€ë„ ì¤‘ì‹¬ì„ ë¶€ë“œëŸ½ê²Œ ì´ë™ì‹œí‚µë‹ˆë‹¤
        // ë§Œì•½ ì´ë™í•  ê±°ë¦¬ê°€ ì§€ë„ í™”ë©´ë³´ë‹¤ í¬ë©´ ë¶€ë“œëŸ¬ìš´ íš¨ê³¼ ì—†ì´ ì´ë™í•©ë‹ˆë‹¤
        map.setLevel(3);
        map.panTo(moveLatLon);            
    }
    
    // ì§€ì—­ ì„ íƒ
    $("#doNameSelect").change(function(){
    	setMapLevel();
    	var doName = $(this).val();
    	console.log(doName);
    	if(doName === "-"){
    		return;
    	}
        $.ajax({
            method: "GET",
            url: "/place/map/city",
            data: {
                doName: doName 
            },
            success: function(response){
 		    	console.log(response);
            	updateInstallPlaceList(response.place);
            	installPlacePaging(response.paging);
            	
 		    	updateResInfo(response.resInfo);
 		    	resInfoPaging(response.resInfoPaging);
 		    	$(".res-search-type").val(doName);
            },
            error: function(xhr, status, err){
            	console.log(err);
            }
        });
    });
    
    const el = document.getElementById('chart-area');
    const data = {
      categories: ['ìì› í˜„í™©'],
      series: [],
    };

    const options = {
	  chart: { 
	  	title: 'ì§€ì—­ë³„ ìì› í˜„í™©',
	   	width: 670,
	   	height: 400,
	  },
      series: {
        dataLabels: {
          visible: true,
          pieSeriesName: {
            visible: true,
            anchor: 'outer'
          }
        }
      },
      theme: {
    	  	series: {
    	      colors: ['#F94144', '#F3722C', '#F8961E', '#F9C74F', '#90BE6D', '#43AA8B', '#577590'],
    	      lineWidth: 2,
    	      strokeStyle: '#000000',
    	    },
    	    tooltip: {
    	      background: '#80CEE1',
    	      borderColor: '#3065AC',
    	      borderWidth: 10,
    	      borderRadius: 20,
    	      borderStyle: 'double',
    	      header: {
    	        fontSize: 15,
    	        fontWeight: 700,
    	        color: '#333333',
    	        fontFamily: 'monospace',
    	      },
    	      body: {
    	        fontSize: 11,
    	        fontWeight: 700,
    	        color: '#a66033',
    	        fontFamily: 'monospace',
    	      }
    	    }
    	  }
    };
    const doNameList = JSON.parse(doNames);

	// ì •ë ¬ëœ ë°ì´í„°ë¥¼ dataì— ì¶”ê°€
	for (const key in doNameList) {
	  if (doNameList.hasOwnProperty(key)) {
	    console.log("key: " + key + " doNameList: " + doNameList[key]);
	    data.series.push({
	      name: key,
	      data: doNameList[key],
	    });
	  }
	}

	console.log(data);
    const chart = toastui.Chart.pieChart({ el, data, options });

    
});
	</script>
</th:block>
</html>